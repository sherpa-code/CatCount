<!DOCTYPE html>
<!--
  author: Jo Crane
  
  'Cat Count' is an interactive single-page web application using HTML, CSS, and JavaScript.
  The goal is to search your apartment (by clicking) all areas in which your cats may be hiding to find them all before the timer expires.
  
  TODO: separate the cat gif from its parent container so that, upon victory or failure, they don't just disappear at that moment.
  TODO: remove the grey colors and row outlines from elements
  TODO: tidy up the starting Instructions modal
  TODO: add to Github Pages
  TODO: center the success and failure message modals
  TODO: add responsiveness via Media Queries for at least 1080p and 4k
  TODO: center gameover modals
-->
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Cat Count!</title>
        <link rel="stylesheet" href="styles.css" />
    </head>
    
    <body>
        <section id="splashPage">
            <div class="container">
                <dialog id="splashTitle">
                    <h1>Cat Count!</h1>
                </dialog>

                <dialog id="instructions">
                    <h1><u>Find Your Kitties!</u></h1>
                    <p>You are about to leave for work in a hurry...</p>
                    <p>but you haven't made sure all your cats haven't gotten into sticky situations!</p>
                    <p>
                        Check every place they could be hiding before the clock runs out or you might be <b><u>late for work!</u></b>
                    </p>
                    <div id="startGameContainer">
                        <button id="startGameButton" onclick="startGame()">Start</button>
                    </div>
                </dialog>

                <div id="letsGoButtonContainer">
                    <button id="letsGoButton" onclick="showInstructions()">
                        <p>Let's go!</p>
                    </button>
                </div>
            </div>
        </section>
         
        <main id="playArea" class="hidden">
            <nav id="goToBedroomButton" class="goToLocationButton" onclick="goToLocation('bedroom')">&#9666; To the Bedroom</nav>
            <nav id="goToKitchenButton" class="goToLocationButton" onclick="goToLocation('kitchen')">To the Kitchen &#9656;</nav>
            <section class="row row__stats">
                <p id="timer" class="stats--display">Timer: <span id="timerValue"></span></p>
                <p id="foundCounter" class="stats--display">Found: <span id="foundCounterValue">0</span>/3</p> <!-- TODO: change the total to be whatever the javascript totalCats count is-->
            </section>

            <div class="finalDialog">
                <dialog class="success" id="successMessage">
                    You found all of your cats, now head to work!<br/>&#128526;<br/><br/>
                    <p class="thanksText">Thanks for playing!<br/><br/>
                        Please check out my other projects at:<br/>
                        <a href="https://github.com/sherpa-code">GitHub</a>
                        <i>- Jo Crane</i>
                    </p>
                    <br/>
                    </p>
                </dialog>
            </div>

            <div class="finalDialog">
                <dialog class="failure" id="failureMessage">
                    You didn't find your cats in time... Oh no! You'll be late!<br>&#129402;
                    <p class="thanksText">Thanks for playing!<br/><br/>
                        Please check out my other projects at:<br/>
                        <a href="https://github.com/sherpa-code">GitHub</a>
                        - Jo Crane
                    </p>
                    <br/>
                </dialog>
            </div>

            <!-- 
            <dialog class="success finalDialog" id="successMessage">
                You found all of your cats, now head to work!<br/>&#128526;<br/><br/>
                <p class="thanksText">Thanks for playing!<br/>
                    Please check out my other projects at:<br/>
                    <a href="https://github.com/sherpa-code">GitHub</a><br>
                    - Jo Crane
                <br/>
                </p>
            </dialog>

            <dialog class="failure finalDialog" id="failureMessage">
                You didn't find your cats in time... Oh no! You'll be late!<br>&#129402;
            </dialog> -->


            <!-- Clickable areas: Kitchen -->
            <section class="kitchen">
                <img src="img/kitchen.jpg" alt="Location Image" id="locationImage" class="backgroundImage">
                <section class="row row__upper">
                    <div class="areaClickable" id="area_kitchen_1">Area 1</div>
                    <div class="areaClickable" id="area_kitchen_2">Area 2</div>
                    <div class="areaClickable" id="area_kitchen_3">Area 3</div>
                    <div class="areaClickable" id="area_kitchen_4">Area 4</div>
                    <div class="areaClickable" id="area_kitchen_5">Area 5</div>
                </section>
                <section class="row row__middle">
                    <div class="areaClickable" id="area_kitchen_6">Area 6</div>
                    <div class="areaClickable" id="area_kitchen_7">Area 7</div>
                </section>
                <section class="row row__bottom">
                    <div class="cupboards bottom-left">
                        <div class="areaClickable" id="area_kitchen_8">Area 8</div>
                    </div>
                    <div class="bottom-second-left-top">
                        <div class="areaClickable" id="area_kitchen_9">Area 9</div>
                        <div class="bottom-second-left-bottom">
                            <div class="areaClickable" id="area_kitchen_10">Area 10</div>
                            <div class="areaClickable" id="area_kitchen_11">Area 11</div>
                        </div>
                    </div>
                    <div class="cupboards bottom-second-right">
                        <div class="areaClickable" id="area_kitchen_12">Area 12</div>
                        <div class="areaClickable" id="area_kitchen_13">Area 13</div>
                    </div>
                    <div class="cupboards bottom-right">
                        <div class="areaClickable" id="area_kitchen_14">Area 14</div>
                        <div class="areaClickable" id="area_kitchen_15">Area 15</div>
                        <div class="areaClickable" id="area_kitchen_16">Area 16</div>
                        <div class="areaClickable" id="area_kitchen_17">Area 17</div>
                        <div class="areaClickable" id="area_kitchen_18">Area 18</div>
                    </div>
                </section>
            </section>

            <!-- Clickable areas: Bedroom -->
            <section class="bedroom hidden">
                <img src="img/bedroom.jpg" alt="Location Image" id="locationImage" class="backgroundImage">
                <section class="row row__upper"> <!-- remove bedroom from child divs and put here -->
                    <!-- <div class="areaClickable" id="area_1" style="top: 22em; left: 13em; width: 18.5em; height: 31em;" onclick="handleClick('that cupboard.')">Area 1</div> -->
                    <div class="areaClickable cupboards" id="area_bedroom_1">Area 1</div>
                    <!-- <div class="areaClickable bedroom" id="area_bedroom_1">Area 1<img src="/img/cat1.gif"></div> -->
                    <!-- <div class="areaClickable bedroom" id="area_bedroom_1" onclick="checkArea(this.id)">Area 1</div> -->
                    <div class="cupboards shelves-stacked">
                        <div class="areaClickable" id="area_bedroom_2">Area 2</div>
                        <div class="areaClickable" id="area_bedroom_3">Area 3</div>
                    </div>
                    <div class="cupboards jewelery-drawer-stacked">
                        <div class="areaClickable" id="area_bedroom_4">Area 4</div>
                        <div class="areaClickable" id="area_bedroom_5">Area 5</div>
                    </div>
                    <div class="areaClickable drapes" id="area_bedroom_6">Area 6</div>
                </section>
                <section class="row row__middle">
                    <div class="closet left">
                        <div class="areaClickable" id="area_bedroom_7">Area 7</div>
                    </div>
                    <div class="closet second-left">
                        <div class="areaClickable" id="area_bedroom_8">Area 8</div>
                    </div>
                    <div class="closet second-middle">
                        <div class="areaClickable" id="area_bedroom_9">Area 9</div>
                        <div class="areaClickable" id="area_bedroom_10">Area 10</div>
                        <!-- <div class="areaClickable" id="area_bedroom_11">Area 11</div>
                        <div class="areaClickable" id="area_bedroom_12">Area 12</div> -->
                    </div>
                </section>
                <section class="row row__bottom">
                    <div class="closet left">
                        <div class="areaClickable" id="area_bedroom_12">Area 12</div>
                        <div class="areaClickable" id="area_bedroom_13">Area 13</div>
                        <div class="areaClickable" id="area_bedroom_14">Area 14</div>
                        <div class="areaClickable" id="area_bedroom_15">Area 15</div>
                    </div>
                    <div class="closet middle">
                    </div>
                    <div class="closet second-middle-bottom">
                        <!-- <div class="areaClickable" id="area_bedroom_16">Area 16</div>
                        <div class="areaClickable" id="area_bedroom_18">Area 18</div>
                        <div class="areaClickable" id="area_bedroom_19">Area 19</div> -->
                    </div>
                    <div class="drawers">
                        <!-- <div class="areaClickable" id="area_bedroom_17">Area 17</div> -->
                        <div class="areaClickable" id="area_bedroom_20">Area 20</div>
                        <div class="areaClickable" id="area_bedroom_21">Area 21</div>
                        <div class="areaClickable" id="area_bedroom_22">Area 22</div>
                    </div>
                    <div class="areaClickable bed" id="area_bedroom_23">Area 23</div>
                </section>
            </section>


        </main>
            
        <script>
            // Graphics and UI
            const playArea = document.getElementsByTagName("main")[0]; // the primary container in the body
            const instructions = document.getElementById("instructions");
            const catImages = [];
            const frownEmoji = '\uD83D\uDE41';
            const heartEmoji = '\u2764\uFE0F';
            let emojiCounter = 0;
            const maxEmojis = 10000;
            const interval = 150; // Adjust the interval (in milliseconds) for adding emojis to the window at the end

            const fadeIn = "fadeIn 0.5s ease-in forwards";
            const fadeOut = "fadeOut 0.5s ease-out forwards";
            const fadeInOut = 'fadeInOut 2s ease-in-out forwards';
            
            // Statistics
            let clickCounter = 0;
            // let timer = 90;
            let timer = 9999;
            let catsFound = 0;
            let totalCats = 3;
            
            // Areas
            let clickedAreas = [];
            let catLocations = [];
            let allAreaNodes = [];
            let arrayFromClickables = Array.from(allAreaNodes); // Convert NodeList to Array (for easier manipulation)
            let areaNames = ["that cupboard", "that drawer", "the sink", "the curtain", "the closet"];
            
            // Interactables
            let goToBedroomButton = document.getElementById("goToBedroomButton");
            let goToKitchenButton = document.getElementById("goToKitchenButton");
            
            // When DOM is fully loaded
            document.addEventListener("DOMContentLoaded", function () {
                let allAreaNodes = document.querySelectorAll('[id^="area_"]'); // Into allAreaNodes NodeList, place all elements with id starting with "area_"
                console.log('%c%s', 'background-color:grey; color:orange', 'allAreaNodes = ' + allAreaNodes);
                arrayFromClickables = Array.from(allAreaNodes); // Convert NodeList to Array (for better manipulation)
                
                allAreaNodes.forEach((e) => {
                    e.addEventListener("click", checkAddClickedAreaToArray);
                });
            });
            
            // 
            function checkAddClickedAreaToArray(e) {
                addAreaToClickedAreas(e);
            }
            
            function addAreaToClickedAreas(e) {
                if (!clickedAreas.includes(e.target.id)) {
                    clickedAreas.push(e.target.id);
                    console.log(clickedAreas);
                    checkForCat(e);
                } else {
                    checkForCat(e);
                }
            }
        
            function startGame() {
                placeCatsRandomly();

                setTimeout(function () {
                    goToBedroomButton.style.display = "block";
                    goToBedroomButton.style.opacity = 1;
                }, 500);

                document.getElementById("playArea").style.animation = fadeIn;
                document.getElementById("playArea").style.display = "flex";

                goToKitchenButton.style.display = "none";

                document.getElementById("splashPage").remove();
                
                runTimer();
            }
                    
            // Randomizes the available clickable areas and adds the first 3 from the
            // randomized array into the catLocations var
            function placeCatsRandomly() {
                const shuffledArray = arrayFromClickables.sort(() => Math.random() - 0.5);
                const selectedAreas = shuffledArray.slice(0, totalCats);
                console.log(selectedAreas);
                selectedAreas.forEach((area, index, array) => {
                    catLocations.push(area.id);
                    var container = document.getElementById(area.id);
                    // container.innerHTML = "<img src='/img/cat1.gif'>";
                    // container.innerHTML = `<img src='/img/cat${index}.gif'>`; // uses string interpolation // change cat image names starting at cat 0
                    container.innerHTML = `<img class='catGif' id='cat${index}' src='/img/cat${index}.gif'>`;
                });

                console.log("Placed cats in the following areas: ", catLocations);
            }

            // Checks if the area clicked is one of the randomized cat locations
            // Triggers visuals if an unfound cat was found or visually notifies if it was not
            function checkForCat(hidingPlace) {
                if (catLocations.includes(hidingPlace.target.id)) {
                    catsFound++;
                    catsFound++; // TODO: disable, debug only
                    catsFound++; // TODO: disable, debug only
                    document.getElementById("foundCounterValue").innerHTML = catsFound;
                    hidingPlace.target.children[0].style.animation = 'fadeInOut 4s ease-in-out forwards';
                    console.log(`Children of this hidingPlace element: `, hidingPlace.target.children);
                    // document.getElementById(hidingPlace.target.id).style.display = 'none';
                    // document.getElementById(hidingPlace.target.id).style.display = 'block';
                    showNotification("❤️", hidingPlace.clientX, hidingPlace.clientY);
                } else {
                    showNotification("Darn, no cat here... 😟", hidingPlace.clientX, hidingPlace.clientY);
                }

                if (catsFound >= totalCats) {
                    // gameOver(true); // right now this is handled by the runTimer()
                }
            }

            
            
            // Function to show a notification modal at the specified coordinates // TODO: create another for showEmoji
            function showNotification(message, x, y) {
                const notificationModal = document.createElement("div");
                notificationModal.className = "notificationModal";
                notificationModal.style.top = y + "px";
                notificationModal.style.left = x + "px";
                notificationModal.style.zIndex = 7;
                // notificationModal.textContent = message;
                notificationModal.innerHTML = message;

                document.body.appendChild(notificationModal);

                // Triggering the fadeInOut animation after a short delay
                setTimeout(() => {
                    notificationModal.style.animation = fadeInOut;
                    notificationModal.style.position = "fixed"; // Ensure the modal stays fixed relative to the viewport
                    notificationModal.style.width = "auto";
                    notificationModal.style.padding = "10px";
                    notificationModal.style.transform = "translate(-50%, -50%) scale(1.5)"; // Center the modal
                    // Removing the modal after the fade-out animation completes
                    setTimeout(() => {
                        notificationModal.remove();
                    }, 40000);
                }, 10);
            }

            // Changes the 'location' the user is in, including animated crossfade and
            // updating the clickable areas to match the new background room image.
            function goToLocation(location) {
                console.log("goToLocation fired: " + location);
                
                // Apply fade-out animation to the image container
                playArea.style.animation = fadeOut;
                if (location === "bedroom") {
                    goToBedroom();
                    goToBedroomButton.style.display = "none"; // Hides the goToBedroomButton

                    // Change the image source after a delay to synchronize with the fade-out animation
                    setTimeout(function () {
                        document.getElementById("locationImage").src = "img/bedroom.jpg"; // Change the image source after fade-out is complete
                        playArea.style.animation = fadeIn;
                    }, 10);
                } else if (location === "kitchen") {
                    goToKitchen();
                } else {
                    console.error("Failed to goToLocation() with an invalid value.");
                }
            }

            function goToKitchen() {
                goToKitchenButton.style.display = "none";

                // Hide the existing Bedroom rows
                document.querySelector(".bedroom").classList.add("hidden");
                // Show the Kitchen rows
                document.querySelector(".kitchen").classList.remove("hidden");
                
                setTimeout(function () {
                    goToBedroomButton.style.display = "block";
                }, 500);

                // Change the image source after a delay to synchronize with the fade-out animation
                setTimeout(function () {
                    // Change the image source after fade-out is complete
                    changeImage("kitchen");
                    
                    // Apply fade-in animation to the image container
                    playArea.style.animation = fadeIn;
                }, 10);

                updateClickableAreas("kitchen");
            }

            function goToBedroom() {
                // Hide the existing goToKitchenButton
                goToBedroomButton.style.display = "none";

                // Hide the existing Kitchen rows
                document.querySelector(".kitchen").classList.add("hidden");
                //Show the Bedroom rows
                document.querySelector(".bedroom").classList.remove("hidden");

                // Show the goToKitchenButton after a delay
                setTimeout(function () {
                    goToKitchenButton.style.display = "block";
                }, 500);

                // Change the image source after a delay to synchronize with the fade-out animation
                setTimeout(function () {
                    changeImage("bedroom");
                    
                    // Apply fade-in animation to the image container
                    playArea.style.animation = fadeIn;
                }, 10);
                
                updateClickableAreas("bedroom");
            }

            function changeImage(location) {
                if (location == "bedroom") {
                    document.getElementById("locationImage").src = "img/bedroom.jpg";
                } else if (location == "kitchen") {
                    document.getElementById("locationImage").src = "img/kitchen.jpg";
                }
            }
            
            function hideClickableAreas() {
                const areas = document.querySelectorAll(".areaClickable");
                console.log(areas);
                areas.forEach(area => areas.remove()); // TODO: fix, not working (console error)
            }

            function showInstructions() {
                instructions.style.display = "block";
                let letsGoButton = document.getElementById("letsGoButton");
                letsGoButton.remove();
            }

            // Function to show a notification modal at the specified coordinates
            function addEmojiRandomly(message, x, y) {
                const emojiModal = document.createElement("div");
                emojiModal.className = "emojiModal";
                emojiModal.style.top = y + "px";
                emojiModal.style.left = x + "px";
                emojiModal.innerHTML = message;
                
                document.getElementById("playArea").appendChild(emojiModal);

                setTimeout(() => {
                    // emojiModal.style.animation = fadeInOut;


                    // emojiModal.style.position = "fixed"; // Ensure the modal stays fixed relative to the viewport
                    // emojiModal.style.position = "absolute"; // Ensure the modal stays fixed relative to the viewport
                    // emojiModal.style.width = "auto";
                    // emojiModal.style.padding = "10px";
                    // emojiModal.style.transform = "translate(-50%, -50%) scale(2)";
                    // emojiModal.style.display = "block";
                    // Removing the modal after the fade-out animation completes
                    setTimeout(() => {
                        emojiModal.remove();
                    }, 40000); // Adjust the duration based on your fadeInOut animation
                }, 10);
            }

            function addEmojiRandomLocation(emoji) {
                const playAreaWidth = playArea.offsetWidth;
                const playAreaHeight = playArea.offsetHeight;
                
                let randomX = Math.floor(Math.random() * playAreaWidth);
                let randomY = Math.floor(Math.random() * (playAreaHeight - 20));

                emojiCounter++;

                if (emojiCounter >= maxEmojis) {
                    clearInterval(emojiInterval);
                }
                
                addEmojiRandomly(emoji, randomX, randomY);
            }

            // function addEmojiRandomLocation(emoji) {
            //     // const viewportWidth = window.innerWidth;
            //     // const viewportHeight = window.innerHeight;

            //     // let randomX = Math.floor(Math.random() * viewportWidth);
            //     // if (randomX > randomX*1.2) {
            //     //     randomX = randomX*1.2;
            //     // } else if (randomX < randomX*0.8) {
            //     //     randomX = randomX*0.8;
            //     // }
            //     // let randomY = Math.floor(Math.random() * viewportHeight);
            //     // if (randomY > randomY*1.2) {
            //     //     randomY = randomY*1.2;
            //     // } else if (randomY < randomY*0.8) {
            //     //     randomY = randomY*0.8;
            //     // }

            //     const playAreaWidth = playArea.offsetWidth;
            //     const playAreaHeight = playArea.offsetHeight;
            //     console.log(playAreaWidth);
            //     console.log(playAreaHeight);
                
            //     // TODO: Make this bit spawn emoji within the picture
            //     let randomX = Math.floor(Math.random() * playAreaWidth);
            //     if (randomX < randomX*1.2) {
            //         randomX = randomX*1.2;
            //     } else if (randomX < randomX*0.8) {
            //         randomX = randomX*0.8;
            //     }
            //     let randomY = Math.floor(Math.random() * playAreaHeight);
            //     if (randomY > randomY*1.2) {
            //         randomY = randomY*1.2;
            //     } else if (randomY < randomY*0.8) {
            //         randomY = randomY*0.8;
            //     }

            //     // let randomX = Math.floor(Math.random() * playAreaWidth);
            //     // if (randomX < randomX*1.2) {
            //     //     randomX = randomX*1.2;
            //     // } else if (randomX > randomX*0.8) {
            //     //     randomX = randomX*0.8;
            //     // }
            //     // let randomY = Math.floor(Math.random() * playAreaHeight);
            //     // if (randomY < randomY*1.2) {
            //     //     randomY = randomY*1.2;
            //     // } else if (randomY > randomY*0.8) {
            //     //     randomY = randomY*0.8;
            //     //}
                

            //     emojiCounter++;

            //     if (emojiCounter >= maxEmojis) {
            //         clearInterval(emojiInterval); // Stop the interval after reaching the desired number of hearts
            //     }
                
            //     addEmojiRandomly(emoji, randomX, randomY);
            // }

            
            // TODO: move the catsFound >= totalCats check to checkForCat()
            function runTimer() {
                var interval = window.setInterval(function(){
                    if ((timer <= 0) && (catsFound < totalCats)) {
                        clearInterval(interval);
                        gameOver(false);
                    } else if (catsFound >= totalCats) {
                        // } else if ((timer <= 0) && (catsFound >= totalCats)) {
                        clearInterval(interval);
                        gameOver(true);
                    } else {
                        timer--;
                        document.getElementById("timerValue").innerHTML = timer;
                    };
                }, 1000);
            }
            
            // Removes all clickable areas from the the screen on fail state, then displays the appropriate modal.
            function gameOver(outcome) {
                hideClickableAreas();
                if (outcome === true) {
                    successful();
                } else {
                    failure();
                }
            }
            
            // TODO: Change background image to a success image when all cats found
            function successful() {
                var successMessage = document.getElementById("successMessage");
                successMessage.style.display = "block";
                // document.getElementsByClassName.src="img/bedroom.jpg"; // TODO: make it so the background image fades slowly into a full-window real life cat picture
                // document.getElementsByClassName.img = src="img/bedroom.jpg"; // TODO: make it so the background image fades slowly into a full-window real life cat picture
                
                // TODO: Make emojis slowly float up
                // Adds a heart emoji at a random location
                const emojiInterval = setInterval(() => {
                    addEmojiRandomLocation(heartEmoji);
                },  interval);
            }
            
            // TODO: Show the cats in the unfound places they were hiding
            function failure() {
                var failureMessage = document.getElementById("failureMessage");
                failureMessage.style.display = "block";
                console.log("Failed at the game");
                const emojiInterval = setInterval(() => {
                    addEmojiRandomLocation(frownEmoji);
                },  interval);
            }
        </script>
    </body>
</html>